
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NetCDF Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container py-5">

        <h2 class="mb-4 text-center">NetCDF Viewer</h2>

        <div class="alert alert-info" role="alert">
            <p>Welcome to the NetCDF Viewer!</p>
            <p>
                A NetCDF file stores multi-dimensional scientific data (e.g., temperature, precipitation),
                including metadata describing dimensions and coordinates.
            </p>
            <p>Upload a file, explore variables, and visualise time steps interactively.</p>
        </div>

        <!-- Upload form -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Upload</button>
                </form>
            </div>
        </div>

        {% if variables %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">

                <!-- Variable + Time Slider Form -->
                <form method="post" class="row g-3">
                    {% csrf_token %}

                    {% if nc_filename %}
                    <input type="hidden" name="existing_file" value="{{ nc_filename }}">
                    {% endif %}

                    <!-- Variable dropdown -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Select variable</label>
                        <select name="variable" class="form-select" onchange="this.form.submit()">
                            {% for var in variables %}
                            <option value="{{ var }}" {% if var == selected_var %}selected{% endif %}>
                                {{ var }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    {% if times %}
                    <!-- Slider -->
                    <div class="col-md-12 mt-3">
                        <label class="form-label fw-bold">Select time step</label>

                        <input type="range"
                               class="form-range"
                               id="timeSlider"
                               name="time_idx"
                               min="0"
                               max="{{ times|length|add:'-1' }}"
                               value="{{ selected_time_idx }}"
                               oninput="updateTimeLabel(this.value)"
                               onchange="this.form.submit()">

                        <!-- Tick marks -->
                        <div class="d-flex justify-content-between mt-1 small text-muted">
                            {% for t in times %}
                            <span>|</span>
                            {% endfor %}
                        </div>

                        <!-- Readout -->
                        <div class="mt-2">
                            <strong>Selected time:</strong>
                            <span id="timeLabel">{{ selected_time }}</span>
                        </div>

                        <!-- Tick number labels -->
                        <div class="d-flex justify-content-between mt-1 small text-muted">
                            {% for t in times %}
                            <span title="{{ t }}" style="display:inline-block;">
                                {{ forloop.counter0 }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                </form>
            </div>
        </div>
        {% endif %}

        {% if metadata %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Metadata</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Dimensions:</strong> {{ metadata.dimensions }}</li>
                    <li class="list-group-item"><strong>Variables:</strong> {{ metadata.variables }}</li>
                    <li class="list-group-item"><strong>Times:</strong> {{ metadata.times }}</li>
                </ul>
            </div>
        </div>
        {% endif %}

        {% if plot_html %}
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Interactive Plot</h5>
                {{ plot_html|safe }}
            </div>
        </div>
        {% endif %}

    </div>

    <script>
function updateTimeLabel(idx) {
    const labels = JSON.parse('{{ times|safe }}'.replace(/&quot;/g,'"'));
    document.getElementById("timeLabel").textContent = labels[idx];
}
    </script>

</body>
</html>
