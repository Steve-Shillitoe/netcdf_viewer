<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NetCDF Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container py-5">
        <h2 class="mb-4 text-center">NetCDF Viewer</h2>
        <div class="alert alert-info" role="alert">
            <p>Welcome to the NetCDF Viewer!</p>
            <p>A NetCDF (Network Common Data Form) file is a standard format for storing multi-dimensional scientific data, 
            such as temperature, precipitation, or radar reflectivity, 
            along with metadata describing dimensions and coordinates.</p>
            <p>This web app allows you to upload NetCDF files and explore their data interactively.</p>
            <p>Once your file is uploaded, you can select a variable and, if your data has multiple time steps, choose a specific time step to visualize.</p>
            <p>The interactive heatmap below will display the selected data slice, and you can hover over it to explore values in detail.</p>
            <p>Use the dropdowns to explore different variables and time steps without re-uploading your file.</p>
        </div>


        <!-- File Upload Form -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Upload</button>
                </form>
            </div>
        </div>

        {% if variables %}
        <!-- Variable / Time Step Form -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form method="post" class="row g-3">
                    {% csrf_token %}

                    <!-- Hidden input for existing file -->
                    {% if nc_filename %}
                    <input type="hidden" name="existing_file" value="{{ nc_filename }}">
                    {% endif %}

                    <div class="col-md-6">
                        <label class="form-label">Select variable</label>
                        <select name="variable" class="form-select" onchange="this.form.submit()">
                            {% for var in variables %}
                            <option value="{{ var }}" {% if var == selected_var %}selected{% endif %}>{{ var }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    {% if times %}
                    <div class="col-md-6">
                        <label class="form-label">Select time step</label>
                        <select name="time_idx" class="form-select" onchange="this.form.submit()">
                            {% for t in times %}
                            <option value="{{ forloop.counter0 }}" {% if forloop.counter0 == selected_time_idx %}selected{% endif %}>
                                {{ t }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <!--<div class="col-12">
                        <button type="submit" class="btn btn-success mt-3">Update Plot</button>
                    </div>-->
                </form>
            </div>
        </div>
        {% endif %}

        {% if metadata %}
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Metadata</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Dimensions:</strong> {{ metadata.dimensions }}</li>
                    <li class="list-group-item"><strong>Variables:</strong> {{ metadata.variables }}</li>
                    <li class="list-group-item"><strong>Times:</strong> {{ metadata.times }}</li>
                </ul>
            </div>
        </div>
        {% endif %}

        {% if plot_html %}
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Interactive Plot</h5>
                {{ plot_html|safe }}
            </div>
        </div>
        {% endif %}
    </div>

</body>
</html>
